# 포팅 매뉴얼

## 기술 스택

1. Issue Management
    - JIRA
2. SCM
    - GitLab
3. Communities
    - Notion
    - MatterMost
    - Gather
4. Development Environment
    - React: ^18.2.0
    - Node.js: ^20.11.0
    - Vite: ^5.0.8
    - OpenvidBrowser: ^2.29.1
    - SpringBoot: ^2.7.17
    - JVM: Zulu "11.0.21" 2023-10-17 LTS
    - VS Code: 1.85.1
    - IntelliJ: 17.0.9+7-b1087.9 amd64
    - DB: Mysql 8.0.28
5. ETC
    - 디자인: Figma
    - UCC: DaVinci Resolve
    - PPT: 미리캔버스 & PowerPoint

## Deployment Command

1. Front & Back End Server 
    
    ```bash
    docker compose -f docker-compose-prod.yml up --build
    ```
    
2. Nginx Web Server

## MySQL WorkBench Connection

1. Spring Boot에서 연결
    1. application.properties
    
    ```jsx
    spring.datasource.url=jdbc:mysql://localhost:3306/"스키마 이름"?serverTimezone=UTC&characterEncoding=UTF-8
    spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
    spring.datasource.username="mysql 계정 아이디"
    spring.datasource.password="mysql 계정 비밀번호"
    ```
    
    b. “스키마 이름”과 동일한 이름의 스키마를 생성
    
2. Standard TCP/IP 연결
    1. MySql Workbench에서 NewConnection
    - Connection Name: 관리용 이름
    - Connection Method: Standard (TCP/IP)
    - HostName: Public DNS 또는 Public IP
    - Port: Mysql이 설치된 포트
    - UserName: 사용자 입력
    - Password: Store in Vault … 을 클릭 후 입력
    - Test Connection을 누르고 에러 메세지가 뜨지 않으면 OK를 누른다.

## Nginx default

```bash
##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#

#limit_req_zone $binary_remote_addr zone=ddos_req:10m rate=5r/s;
#limit_conn_zone $binary_remote_addr zone=addr:10m;
#limit_req_status 429;

client_max_body_size 10M;

server {

        listen 443 ssl;
        listen [::]:443 ssl ipv6only=on;

        #ssl on;
        ssl_certificate /etc/ssl/certificate.crt;
        ssl_certificate_key /etc/ssl/private.key;

        #listen 3000 default_server;
        #listen [::]:3000 default_server;

        #client_body_timeout 5s;
        #client_header_timeout 5s;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;
        #

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        #server_name kingoffish.shop;
        server_name _;

        location / {
                #limit_req zone=ddos_req burst=5;
                #limit_conn ddos_conn 10;
                proxy_pass http://i10c203.p.ssafy.io:5173;
        }

        location /openvidu {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                #limit_req zone=ddos_req burst=5;
                #limit_conn addr 10;
                proxy_pass http://i10c203.p.ssafy.io:5443/openvidu;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
                proxy_http_version 1.1;
                #proxy_pass http://i10c203.p.ssafy.io:8443;
                #try_files $uri $uri/ =404;
        }

        location /api {
                #limit_req zone=ddos_req burst=5;
                #limit_conn addr 10;
                proxy_pass http://localhost:8081;
        }

        error_page 404 /Error404.html;
        location = /Error404.html {
                root  /usr/share/nginx/html;
        }

        error_page 500 502 503 504 /Error500.html;
        location = /Error500.html {
                root /usr/share/nginx/html/;
        }

        error_page 429 /Error429.html;
        location = /Error429.html {
                root /usr/share/nginx/html/;
        }

        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}
}

server {
        if ($host = i10c203.p.ssafy.io) {
                return 301 https://$host$request_uri;
        }

        listen 3000 default_server;
        listen [::]:3000 default_server;

        server_name _;

        error_page 404 /Error404.html;
        location = /Error404.html {
                root /usr/share/nginx/html/;
        }

        return 404;
}

#server {
        #listen 443;

        #ssl on;
        #ssl_certificate /etc/ssl/certificate.crt;
        #ssl_certificate_key /etc/ssl/private.key;

        #server_name _;
        #access_log /var/log/nginx/nginx.vhost.access.log;
        #error_log /var/log/nginx/nginx.vhost.error.log;

        #location /openvidu {
        #       proxy_pass http://i10c203.p.ssafy.io:5443/openvidu;
        #       proxy_set_header Upgrade $http_upgrade;
        #       proxy_set_header Connection "upgrade";
        #       proxy_http_version 1.1;
        #}

        #location /api {
        #       proxy_pass http://localhost:8081/api;
        #}

        #location / {
        #       proxy_pass http://localhost:5173;
        # }
#}

#server {
#       listen 8080;

#       location /jenkins {
#               proxy_pass http://localhost:8080;
#       }
#}

# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
```

## EC2 Setting

1. Docker
    - EC2 서버에 터미널에서 Redis docker 설치
    
    ```bash
    docker pull redis
    docker run -it -d --rm -p 6379:6379 --name redis redis
    
    docker pull mysql
    docker run -p 3307:3307 --name mysql -e MYSQL_ROOT_PASSWORD={비밀번호} -d mysql
    ```
    
    - EC2 서버에 올리고 나서 터미널에서 Docker build & run
    
    ```bash
    // springboot backend image build 및 실행
    docker build -l back ./back
    docker run -it -d --rm -p 8081:8081 --name back back
    
    // front image build 및 실행
    docker build --no-cahe -t front ./front
    docker run -it -d --rm -p 5713:5713 --name front front
    ```
    

## Files ignored

```bash
HELP.md
.gradle
build/
!gradle/wrapper/gradle-wrapper.jar
!**/src/main/**/build/
!**/src/test/**/build/

### STS ###
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
.sts4-cache
bin/
!**/src/main/**/bin/
!**/src/test/**/bin/

### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr
out/
!**/src/main/**/out/
!**/src/test/**/out/

### NetBeans ###
/nbproject/private/
/nbbuild/
/dist/
/nbdist/
/.nb-gradle/

### VS Code ###
.vscode/

### properties ###
application-chatbot.properties
application-oauth.properties
application-aws.properties
application-test.properties
application-dev.properties
application-prod.properties

### docker env file ###
.env

/src/main/generated
```

## Settings or Tips

1. 환경 변수 설치
    
    ```bash
    git submodule init
    git submodule update
    ```
    
2. 외부 서비스 사용
    1. KaKao Oauth
        - https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api
    2. Naver Oauth
        - https://developers.naver.com/docs/login/api/api.md
    3. Naver CLOVA
        - https://www.ncloud.com/product/aiService/chatbot
